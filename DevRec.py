import pandas as pd 
import os
import numpy as np
from pymoo.algorithms.moo.nsga2 import NSGA2
from pymoo.algorithms.moo.nsga3 import NSGA3
from pymoo.algorithms.moo.unsga3 import UNSGA3
from pymoo.algorithms.moo.moead import MOEAD, ParallelMOEAD
from pymoo.algorithms.moo.age import AGEMOEA
from pymoo.algorithms.moo.ctaea import CTAEA
from pymoo.visualization.scatter import Scatter

from pymoo.factory import get_crossover, get_mutation, get_sampling, get_reference_directions
from pymoo.core.problem import Problem, ElementwiseProblem
from pymoo.factory import get_performance_indicator
from pymoo.optimize import minimize


import warnings
warnings.filterwarnings("ignore")

from pymoo.config import Config
Config.show_compile_hint = False

import json
import os
import statistics
from statistics import mean

#
data_path = 'C:/Users/AP55330.ENS/Downloads/Expermints/NSGA-II/sent_data/New_NSGA-II/Metric_evaluations_rev7/main/main1/dataset22/main11/main13'

def f1(X,df): 
    de = []
    for i in range(len(df)):
        de.append(int(X[i])*((((df['Submission_challenges'][i] / df['total_Registration'][i])+( df['totalWins'][i] // df['Submission_challenges'][i]))*((1 / df['task_recency'][i])* 100)) + df['CP_score'][i] ))
    f1 = - (sum(de)/ len(de)) if len(de) > 0 else 0
    return f1

def f2(X,df): 
    sds = []
    for i in range(len(df)):
        sds.append(int(X[i])*(df['Cosine_similarity_descriptions'][i] + df['Cosine_similarity_skills'][i] + df['Cosine_similarity_score_task_titles_current_past'][i] + df['Cosine_similarity_score_task_descriptions_current_past'][i] + df['Cosine_similarity_score_task_skills_current_past'][i]))
    f2 = - (sum(sds) / len(sds)) if len(sds) > 0 else 0
    return f2 

def f3(X,df):
    ad = []
    for i in range(len(df)):
        ad.append(int(X[i])*(df['activechallenges'][i]))

    f3 = (sum(ad) / len(ad)) if len(ad) > 0 else 0
    return f3 

class MyProblem(ElementwiseProblem):

    def __init__(self,task_df, maxSize, minSize,objectives = [f1,f2,f3]):

        self.task_df = task_df
        self.maxSize = maxSize
        self.minSize = minSize
        self.objectives = objectives
        super().__init__(n_var=len(self.task_df),
                         n_obj=3,
                         n_constr=2,
                         sampling = get_sampling('real_random')
                
                         )

    def _evaluate(self, X, out, *args, **kwargs):

        # Fitness functions

        obj1 = self.objectives[0](X,self.task_df)
        obj2 = self.objectives[1](X,self.task_df)
        obj3 = self.objectives[2](X,self.task_df)
        g1 = (self.minSize - np.sum(X))
        g2 = (np.sum(X) - self.maxSize)

        out["F"] = [obj1, obj2, obj3]
        out["G"] = [g1, g2]   
#   Main 
all_data = pd.read_csv(os.path.join(data_path,'dataset_test_V2.csv'))

# ............................ Parameters 
pop_size = 120
n_gen = 80
minSize = 1 
maxSize = 600000
obj_algo_name = 'AGEMOEA' 
topK = 20

if obj_algo_name ==  'NSGA2':
    obj_algo = NSGA2
if obj_algo_name == 'NSGA3':
    obj_algo = NSGA3
if obj_algo_name == 'UNSGA3':
    obj_algo = UNSGA3
if obj_algo_name == 'AGEMOEA':
    obj_algo = AGEMOEA
    
# We compute reccommended member for all task
hv_all = [] 
MAP_all = []
MAR_all = [] 
MRR_all = []
GD_all = []
IGD_all = []

def number_pareto_efficient_dumb(costs):
    """ Count the number of Non-dominated solutions (1st pareto front) from last population generated"""
    is_efficient = np.ones(costs.shape[0], dtype = bool)
    nb = 0
    for i, c in enumerate(costs):
        is_efficient[i] = np.all(np.any(costs[:i]>c, axis=1)) and np.all(np.any(costs[i+1:]>c, axis=1))
        if is_efficient[i] == True:
            nb = nb + 1
    return nb

number = 2
jj = 0
for STUDIED_TASK in all_data['task_Id'][:2]:
    jj = jj + 1

    TASK_DF = all_data[all_data['task_Id'] ==  STUDIED_TASK]
    ref_dirs = get_reference_directions("das-dennis", 3, n_partitions=3) #12
    vectorized_problem = MyProblem(TASK_DF , minSize=minSize, maxSize=maxSize)
    algorithm = obj_algo(
                pop_size=pop_size,
                ref_dirs=ref_dirs,
                sampling=get_sampling("bin_random"),
                crossover=get_crossover("bin_one_point"),
                mutation=get_mutation("bin_bitflip", prob=1/vectorized_problem.n_var),
                seed=1 # ?
            ) 

    if jj == number:
        ver = True
    else:
        ver = False

    res = minimize(vectorized_problem,
               algorithm,
               termination=('n_gen', n_gen),
               verbose=ver)

    # HV
    all_ones= [1 for i in range(len(TASK_DF))]
    hv_ = get_performance_indicator("hv", ref_point=np.array([0, 0, f3(all_ones,TASK_DF)])) 
    hv = hv_.do(res.F)
    if jj == number:
        print("hv", hv)
    hv_all.append(hv)

    pop = res.pop
    X = pop.get("X") # Design space values are  
    F = pop.get("F") # Objective spaces values
    nb_efficient = number_pareto_efficient_dumb(F) # retrieve the number of Non-dominated solutions (1st pareto front) from last population generated
    if nb_efficient == 0:
        nb_efficient = len(X)
    else:
        nb_efficient == min (topK, nb_efficient)

    A = F[:nb_efficient] # Result give by algorithm

    # Load previous ref points from last trainning
    if os.path.exists('ref_points.txt.txt') == True:
        with open('ref_points.txt', 'r') as f:
            ref_points = json.loads(f.read())
    else : 
        ref_points = A[::10] * 1.1 # set manually


    # GD and IGD
    gd_ = get_performance_indicator("gd", ref_points)
    gd = gd_.do(A)
    if jj == number:
        print("GD", gd)
    GD_all.append(gd)
    igd_ = get_performance_indicator("igd", ref_points)
    igd = igd_.do(A)

    if jj == number:
        print("IGD", igd)
    #print("IGD", igd.do(A))
    IGD_all.append(igd)

    # Load previous test samples points from last trainning
    #if os.path.exists('test_samples.txt') == True:
       # with open('test_samples.txt', 'r') as f:
            #test_samples = json.loads(f.read())
    #else:
    test_samples = [[4, 12, 17, 18, 19, 20, 21, 28, 35, 38, 40, 41, 42, 44, 45, 46, 51, 53, 54, 55, 58, 60, 61, 62, 63, 65, 67, 78, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 19, 20, 21, 43, 46, 47, 48, 55, 56, 58, 60, 61, 62, 63, 64, 65, 67, 68, 78, 82, 83, 84, 86, 88, 90, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 5, 7, 11, 12, 16, 18, 19, 20, 28, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 14, 15, 19, 20, 21, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 38, 39, 40, 41, 42, 44, 45, 46, 49, 51, 52, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 19, 21, 43, 46, 47, 48, 55, 56, 58, 59, 60, 61, 62, 63, 65, 68, 69, 71, 74, 75, 76, 77, 78, 79, 80, 82, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 117, 118, 119, 120, 121, 122, 123, 124, 126, 127, 129, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 5, 7, 12, 13, 16, 17, 18, 19, 20, 21, 28, 30, 40, 41, 42, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 64, 66, 68, 69, 70, 73, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 24, 27, 29, 32, 33, 34, 35, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 56, 57, 58, 60, 61, 62, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 81, 83, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 6, 10, 11, 12, 13, 16, 17, 18, 19, 20, 21, 43, 46, 47, 48, 49, 50, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 14, 15, 19, 20, 21, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 38, 39, 40, 41, 42, 44, 45, 46, 49, 51, 52, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 67, 68, 69, 70, 71, 74, 75, 77, 78, 81, 82, 83, 84, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 23, 24, 25, 27, 29, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 12, 17, 18, 19, 20, 21, 43, 46, 47, 48, 55, 56, 58, 60, 61, 62, 63, 64, 65, 67, 68, 69, 78, 82, 83, 84, 86, 88, 90, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 19, 21, 43, 46, 48, 55, 56, 58, 60, 61, 62, 63, 65, 67, 69, 70, 71, 74, 75, 76, 77, 78, 79, 81, 83, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 12, 17, 18, 19, 20, 21, 28, 35, 38, 40, 41, 42, 44, 45, 46, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 65, 67, 78, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 142, 143, 145, 146, 147], [3, 9, 12, 13, 16, 17, 18, 19, 20, 21, 28, 30, 40, 41, 42, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 64, 66, 68, 69, 70, 73, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 5, 7, 12, 17, 18, 19, 20, 21, 28, 41, 42, 43, 45, 46, 53, 54, 55, 56, 58, 60, 61, 62, 63, 65, 66, 67, 78, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 142, 143, 145, 146, 147], [4, 9, 12, 19, 21, 40, 41, 42, 44, 45, 46, 49, 51, 53, 54, 55, 56, 60, 61, 62, 63, 64, 66, 68, 69, 70, 71, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 30, 35, 41, 42, 44, 45, 46, 47, 48, 49, 50, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 67, 68, 69, 70, 71, 74, 75, 77, 78, 81, 82, 83, 84, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 4, 5, 7, 8, 9, 10, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 28, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [3, 9, 12, 21, 43, 46, 47, 48, 50, 53, 54, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 81, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 41, 42, 43, 45, 46, 53, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 19, 21, 43, 45, 46, 52, 55, 56, 58, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 85, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 23, 24, 25, 27, 29, 32, 33, 34, 35, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 56, 57, 58, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 142, 143, 145, 146, 147], [1, 2, 5, 7, 12, 21, 43, 46, 47, 48, 50, 53, 54, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 4, 5, 7, 8, 9, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 28, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 4, 5, 7, 8, 9, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 28, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 71, 74, 75, 76, 77, 78, 79, 80, 81, 82, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [9, 12, 17, 18, 19, 20, 21, 28, 41, 42, 43, 46, 55, 58, 60, 61, 62, 63, 66, 68, 69, 70, 74, 75, 77, 78, 79, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 21, 41, 42, 43, 45, 46, 54, 55, 56, 60, 62, 63, 65, 67, 68, 78, 82, 83, 84, 86, 90, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 115, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 4, 5, 7, 8, 9, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 28, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 24, 25, 27, 29, 32, 33, 34, 35, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 56, 57, 58, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 100, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [3, 9, 12, 21, 43, 46, 47, 48, 50, 53, 54, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 12, 17, 18, 19, 20, 21, 28, 35, 38, 40, 41, 42, 44, 45, 46, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 65, 67, 78, 82, 83, 84, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 14, 15, 17, 18, 19, 20, 21, 28, 30, 40, 41, 42, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 5, 7, 12, 17, 18, 19, 21, 41, 42, 43, 45, 46, 53, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [3, 4, 12, 17, 18, 19, 20, 21, 28, 35, 38, 40, 41, 42, 44, 45, 46, 51, 53, 54, 55, 58, 60, 61, 62, 63, 65, 67, 78, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [2, 3, 5, 6, 7, 8, 9, 11, 12, 14, 15, 17, 18, 19, 20, 21, 28, 30, 35, 36, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 56, 57, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 135, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 19, 21, 43, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 21, 41, 42, 43, 45, 46, 54, 55, 56, 60, 62, 63, 65, 67, 68, 78, 82, 83, 84, 86, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 23, 27, 30, 35, 36, 38, 39, 40, 41, 42, 44, 45, 46, 49, 51, 52, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 24, 25, 27, 29, 32, 33, 34, 35, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 56, 57, 58, 60, 61, 62, 63, 64, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 81, 83, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 118, 119, 121, 122, 123, 124, 126, 127, 129, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 5, 7, 12, 17, 18, 19, 21, 28, 41, 42, 43, 45, 46, 53, 55, 56, 58, 60, 61, 62, 63, 65, 67, 68, 78, 82, 83, 84, 86, 88, 90, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [2, 3, 5, 6, 7, 8, 9, 11, 12, 14, 15, 17, 18, 19, 20, 21, 28, 30, 35, 36, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 56, 57, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [3, 9, 12, 17, 18, 20, 21, 28, 31, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 86, 87, 88, 90, 91, 92, 93, 94, 95, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 14, 15, 19, 20, 21, 24, 25, 27, 28, 29, 31, 32, 33, 34, 38, 39, 40, 41, 42, 44, 45, 46, 49, 50, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 67, 68, 69, 70, 71, 74, 75, 77, 78, 81, 82, 83, 84, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [5, 7, 9, 12, 17, 18, 19, 20, 21, 28, 41, 42, 43, 46, 55, 56, 58, 60, 61, 62, 63, 66, 68, 69, 70, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 12, 17, 18, 19, 20, 21, 43, 46, 47, 48, 50, 53, 54, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 19, 21, 43, 46, 47, 48, 55, 56, 58, 60, 61, 62, 63, 64, 65, 67, 68, 78, 82, 83, 84, 86, 88, 90, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 24, 25, 27, 29, 32, 33, 35, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 56, 57, 58, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 126, 127, 128, 129, 130, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 4, 5, 7, 12, 17, 18, 19, 20, 21, 28, 35, 38, 40, 41, 42, 44, 45, 46, 51, 53, 54, 55, 58, 60, 61, 62, 63, 65, 67, 78, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 6, 10, 13, 16, 17, 18, 19, 20, 21, 23, 27, 30, 35, 36, 38, 40, 41, 42, 45, 46, 49, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 132, 133, 134, 135, 137, 138, 139, 140, 142, 143, 144, 145, 146, 147], [5, 7, 12, 16, 17, 18, 19, 20, 21, 28, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 71, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 136, 137, 138, 139, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 30, 35, 41, 42, 44, 45, 46, 47, 48, 49, 50, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 67, 68, 69, 70, 71, 74, 75, 77, 78, 81, 82, 83, 84, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 12, 17, 18, 19, 20, 21, 43, 46, 47, 48, 55, 56, 58, 60, 61, 62, 63, 64, 65, 67, 68, 69, 78, 82, 83, 84, 86, 88, 90, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 117, 118, 119, 120, 121, 122, 123, 124, 126, 127, 129, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 4, 5, 7, 8, 9, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 28, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 71, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [5, 7, 12, 16, 17, 18, 19, 20, 21, 28, 41, 42, 43, 45, 54, 55, 56, 58, 60, 61, 62, 63, 65, 67, 68, 72, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 137, 138, 139, 140, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 24, 25, 27, 29, 32, 33, 34, 35, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 56, 57, 58, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 100, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 140, 141, 142, 143, 144, 145, 146, 147], [3, 9, 12, 17, 18, 20, 21, 28, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 5, 7, 9, 12, 17, 18, 19, 20, 21, 28, 40, 41, 42, 43, 46, 55, 56, 60, 61, 62, 63, 65, 67, 68, 78, 82, 83, 84, 86, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 103, 104, 105, 106, 107, 109, 110, 112, 113, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 19, 21, 43, 46, 48, 55, 56, 58, 60, 61, 62, 63, 65, 67, 69, 70, 71, 74, 75, 76, 77, 78, 79, 81, 83, 84, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 132, 133, 134, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 15, 17, 18, 19, 20, 21, 28, 30, 40, 41, 42, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 100, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 12, 17, 18, 19, 20, 21, 43, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 132, 133, 134, 135, 136, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 6, 10, 12, 13, 16, 17, 18, 19, 20, 21, 43, 46, 54, 55, 56, 58, 60, 61, 62, 63, 65, 67, 68, 74, 78, 82, 83, 84, 86, 89, 90, 91, 92, 93, 94, 95, 96, 97, 99, 101, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 5, 7, 12, 17, 18, 19, 20, 21, 28, 41, 42, 43, 45, 46, 53, 55, 56, 60, 61, 62, 63, 65, 67, 68, 78, 82, 83, 84, 86, 88, 90, 92, 93, 94, 95, 96, 97, 98, 100, 101, 102, 104, 105, 107, 108, 110, 111, 112, 113, 114, 115, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [2, 4, 5, 6, 7, 8, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 27, 30, 35, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101, 102, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 4, 5, 7, 8, 9, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 28, 40, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 19, 21, 41, 42, 43, 46, 47, 48, 49, 50, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 81, 82, 83, 84, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 23, 24, 25, 27, 29, 32, 33, 34, 35, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 56, 57, 58, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101, 103, 104, 105, 106, 108, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 5, 7, 12, 17, 18, 19, 20, 21, 28, 41, 42, 43, 45, 46, 53, 54, 55, 56, 58, 61, 62, 63, 64, 65, 66, 69, 70, 73, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 6, 10, 12, 17, 18, 19, 20, 21, 28, 35, 40, 41, 42, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 80, 81, 82, 83, 84, 85, 86, 87, 88, 90, 92, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 117, 118, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 142, 145, 146, 147], [5, 7, 12, 16, 17, 18, 19, 20, 21, 28, 42, 43, 45, 46, 54, 55, 56, 58, 60, 61, 62, 63, 65, 67, 68, 74, 78, 80, 82, 83, 84, 86, 89, 90, 91, 92, 93, 94, 95, 96, 97, 99, 101, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 5, 7, 12, 17, 18, 19, 20, 21, 28, 41, 42, 43, 45, 46, 53, 55, 56, 60, 61, 62, 63, 65, 67, 68, 78, 82, 83, 84, 86, 88, 90, 92, 93, 94, 95, 96, 97, 98, 100, 101, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 9, 12, 19, 21, 43, 45, 46, 52, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 5, 7, 11, 12, 13, 14, 16, 17, 18, 20, 21, 23, 28, 30, 35, 42, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 61, 62, 63, 64, 65, 66, 68, 69, 70, 73, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 17, 19, 20, 21, 22, 23, 24, 25, 27, 29, 32, 33, 34, 35, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 52, 53, 55, 56, 57, 58, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 5, 7, 11, 12, 16, 18, 19, 20, 21, 28, 42, 43, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [3, 9, 12, 21, 43, 46, 47, 48, 50, 53, 54, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 5, 6, 10, 12, 17, 18, 19, 20, 21, 28, 35, 38, 40, 41, 42, 44, 45, 46, 51, 52, 53, 55, 56, 58, 60, 61, 62, 63, 65, 66, 67, 78, 82, 83, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 118, 119, 120, 121, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 12, 17, 18, 19, 20, 21, 43, 46, 47, 48, 50, 53, 54, 55, 56, 58, 60, 61, 62, 63, 64, 66, 68, 69, 70, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 104, 105, 106, 107, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 3, 6, 10, 12, 17, 18, 19, 20, 21, 28, 35, 40, 41, 42, 44, 45, 46, 49, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 63, 65, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 85, 86, 87, 88, 90, 91, 92, 93, 94, 95, 96, 97, 98, 100, 102, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 30, 35, 41, 42, 44, 45, 46, 47, 48, 49, 50, 51, 53, 54, 55, 56, 58, 60, 61, 62, 63, 67, 68, 69, 70, 71, 74, 75, 76, 77, 78, 81, 82, 83, 84, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101, 102, 103, 104, 105, 106, 107, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125, 126, 128, 129, 130, 131, 132, 133, 134, 135, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147], [4, 12, 17, 18, 19, 20, 21, 28, 41, 42, 43, 46, 55, 56, 58, 60, 61, 62, 63, 66, 68, 69, 70, 74, 75, 76, 77, 78, 79, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 108, 110, 111, 112, 113, 114, 115, 116, 118, 119, 121, 122, 123, 124, 125, 126, 127, 129, 131, 132, 133, 134, 135, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147]]
   
   # Precision and recall
    AP_k_all = [] 
    R_k_all = []
    for i in range(nb_efficient):
        P = []
        R = []
        for test in test_samples:
            k_is_relevant = 0
            k=0
            for j in range(len(X[i])):
                if X[i][j] == True: 
                    k += 1 
                    if j+1 in test:
                        k_is_relevant+=1
            P.append(k_is_relevant / k if k > 0 else 0)
            R.append(k_is_relevant / len(test) if len(test) > 0 else 0)

        AP_k_all.append(sum(P) / len(P) if len(P) > 0 else 0)
        R_k_all.append(sum(R) / len(R) if len(R) > 0 else 0)

    # Mean Reciprocal rang
    test_samples_merged = set([j for i in test_samples for j in i])
    MRR_all = []
    for i in range(nb_efficient):
        true_positive_position = []
        for j in range(len(X[i])):
            if X[i][j] in  test_samples_merged:
                true_positive_position.append(j+1)
        MRR_all.append( (1 / true_positive_position[0]) if len(true_positive_position) > 0 else 0 )


    MAP = mean(AP_k_all) if len(AP_k_all) > 0 else 0
    MAR = mean(R_k_all) if len(R_k_all) > 0 else 0
    MRR = mean(MRR_all) if len(MRR_all) > 0 else 0
    if jj == number:
        print('P@K', MAP)
    if jj == number:
        print('R@K', MAR)
    if jj == number:
        print('MRR', MRR)


    MAP_all.append(MAP)
    MAR_all.append(MAR)
    MRR_all.append(MRR)

    #print('\n\n')

    #...... Save results into file
    with open('recommended_members.txt', 'w', encoding='utf8') as file:
        file.write('Metric evaluations\n')
        file.write("Mean Average Precision : " + str(MAP) + "\n")
        file.write("Mean Average Recall : " + str(MAR) + "\n")
        file.write("Mean Reciprocal Rank : " + str(MRR) + "\n")
        file.write('GD: '+str(gd)+'\n')
        file.write('IGD: '+str(igd)+'\n')
        file.write('hv: '+str(hv)+'\n')
        file.write('\nRecommended members with fitness values\n')
        test_samples = []
        ref_points_list = A
        for i in range(nb_efficient):
            file.write("Solution " + str(i+1)  + "\n")
            file.write("Obj 1: " + str(-F[i][0]) + "\n")
            file.write("Obj 2: " + str(-F[i][1]) + "\n")
            file.write("Obj 3: " + str(-F[i][2]) + "\n")

            binary_string = ""
            id_members = []
            for j in range(len(X[i])):
                if X[i][j] == False:
                    b = 0
                else:
                    b = 1
                    id_members.append(j+1)
                binary_string = binary_string + str(b)
            test_samples.append(id_members)
            file.write("Binary string: " + binary_string + "\n\n")

        with open('test_samples.txt', 'w') as f:
            f.write(json.dumps(test_samples))

        with open('ref_points.txt', 'w') as f:
            f.write(json.dumps([list(x) for x in ref_points_list]))

    # Data viz for hv
    '''
    plot = Scatter(tight_layout=True)
    plot.add(res.F,s=10)
    plot.add(np.array([0, 0, f3(all_ones,TASK_DF)]))
    plot.show()
    '''

#...... Save median results into file
with open('metrics median results.txt', 'w', encoding='utf8') as file:
    file.write("HV median: " + str(statistics.median(hv_all)) + "\n")
    file.write("GD median: " + str(statistics.median(GD_all)) + "\n")
    file.write("IGD median: " + str(statistics.median(IGD_all)) + "\n")
    file.write("MAP median: " + str(statistics.median(MAP_all)) + "\n")
    file.write("MAR median: " + str(statistics.median(MAR_all)) + "\n")
    file.write("MRR median: " + str(statistics.median(MRR_all)) + "\n")


